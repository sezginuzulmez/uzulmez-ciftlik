<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Üzülmez Çiftlik – Gelir Gider</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png" sizes="192x192">
  <meta name="theme-color" content="#0ea5e9"/>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>Üzülmez Çiftlik – Gelir &amp; Gider</h1>
    <div class="row">
      <span id="userBadge" class="userBadge"></span>
      <button id="lockBtn" class="secondary">Kilitle</button>
      <button id="installBtn" class="secondary">Uygulamayı Yükle</button>
    </div>
  </header>

  <!-- AUTH SCREENS -->
  <main id="authSetup" class="auth hidden">
    <section class="card">
      <h2>İlk Kurulum – Yönetici Oluştur</h2>
      <p>Bu cihazda ilk kez açtınız. Bir <strong>Yönetici</strong> hesabı oluşturun.</p>
      <form id="setupForm" class="grid">
        <label>Ad / Kullanıcı adı
          <input type="text" id="setupName" placeholder="örn. Sezgin" required>
        </label>
        <label>PIN (4–12 rakam)
          <input type="password" id="setupPin" pattern="\d{4,12}" placeholder="örn. 1234" required>
        </label>
        <label>PIN Tekrar
          <input type="password" id="setupPin2" pattern="\d{4,12}" placeholder="PIN tekrar" required>
        </label>
      </form>
      <div class="row">
        <button id="setupCreate">Yönetici Oluştur</button>
      </div>
    </section>
  </main>

  <main id="authLogin" class="auth hidden">
    <section class="card">
      <h2>Giriş Yap</h2>
      <form id="loginForm" class="grid">
        <label>Kullanıcı
          <select id="loginUser"></select>
        </label>
        <label>PIN
          <input type="password" id="loginPin" pattern="\d{4,12}" required>
        </label>
      </form>
      <div class="row">
        <button id="loginBtn">Giriş</button>
        <small id="loginHint" class="muted"></small>
      </div>
    </section>
  </main>

  <!-- APP CONTENT -->
  <main id="appMain" class="hidden">
    <section class="card">
      <h2>Yeni Kayıt</h2>
      <form id="entryForm">
        <div class="grid">
          <label>Tür
            <select id="type">
              <option value="gider">Gider</option>
              <option value="gelir">Gelir</option>
            </select>
          </label>

          <label>Kategori
            <select id="category">
              <option value="Yem">Yem</option><option value="İlaç">İlaç</option><option value="Akaryakıt">Akaryakıt</option><option value="Elektrik">Elektrik</option><option value="İşçilik">İşçilik</option><option value="Bakım/Onarım">Bakım/Onarım</option><option value="Süt Satışı">Süt Satışı</option><option value="Hayvan Satışı">Hayvan Satışı</option><option value="Hayvan Alımı">Hayvan Alımı</option><option value="Gübre Satışı">Gübre Satışı</option><option value="Diğer">Diğer</option>
            </select>
          </label>

          <label>Ürün
            <select id="productSelect">
              <option value="Saman">Saman</option><option value="Silaj">Silaj</option><option value="Posa">Posa</option><option value="Çöğenler Süt">Çöğenler Süt</option><option value="Süt">Süt</option><option value="Tariş Süt">Tariş Süt</option><option value="Ödemiş Süt">Ödemiş Süt</option><option value="Gebe Yemi">Gebe Yemi</option><option value="Düve Yemi">Düve Yemi</option><option value="Arpa">Arpa</option><option value="Mısır">Mısır</option><option value="Soya">Soya</option><option value="Bypass Yağı">Bypass Yağı</option><option value="Toksin Bağlayıcı">Toksin Bağlayıcı</option><option value="Buffer">Buffer</option><option value="Soda">Soda</option><option value="Diğer">Diğer</option>
            </select>
          </label>

          <label>Ürün (Diğer/Açıklama)
            <input type="text" id="productOther" placeholder="Serbest metin" disabled />
          </label>

          <label>Alış Tarihi
            <input type="date" id="purchaseDate" value="2025-11-03" required />
          </label>

          <label>Ödeme Tarihi
            <input type="date" id="paymentDate" />
          </label>

          <label>Birim
            <select id="unit">
              <option value="kg" selected>kg</option><option value="ton" >ton</option><option value="balya" >balya</option><option value="çuval" >çuval</option><option value="litre" >litre</option><option value="adet" >adet</option>
            </select>
          </label>

          <label>Miktar
            <input type="number" step="0.01" id="quantity" placeholder="örn. 130" />
          </label>

          <label>Birim Fiyat (TL)
            <input type="number" step="0.01" id="unitPrice" placeholder="örn. 12.50" />
          </label>

          <label>Toplam Tutar (TL)
            <input type="number" step="0.01" id="totalPrice" placeholder="otomatik hesaplanır" disabled />
          </label>

          <label>Ödenen (TL)
            <input type="number" step="0.01" id="paidAmount" placeholder="örn. 5000" />
          </label>

          <label>Kalan (TL)
            <input type="number" step="0.01" id="remainingAmount" placeholder="otomatik hesaplanır" disabled />
          </label>
        </div>

        <div class="row wrap" style="margin-top:10px;">
          <span class="muted">Hızlı Şablonlar:</span>
          <button type="button" class="chip" id="tplSilaj">Silaj Alımı</button>
          <button type="button" class="chip" id="tplSut">Süt Satışı</button>
          <button type="button" class="chip" id="tplAkaryakit">Akaryakıt Alımı</button>
          <button type="button" class="chip" id="tplIlac">İlaç Alımı</button>
          <button type="button" class="chip" id="tplBakimTraktor">Bakım/Onarım – Traktör</button>
        </div>

        <div class="row">
          <button type="submit" id="addBtn">Kaydı Ekle</button>
          <button type="reset" class="secondary">Temizle</button>
        </div>
      </form>
    </section>

    <section class="card">
      <h2>Özet & Grafikler</h2>
      <div class="summary">
        <div><strong>Toplam Gelir:</strong> <span id="sumIncome">0</span> TL</div>
        <div><strong>Toplam Gider:</strong> <span id="sumExpense">0</span> TL</div>
        <div><strong>Net:</strong> <span id="sumNet">0</span> TL</div>
        <div><strong>Toplam Kalan (borç):</strong> <span id="sumRemaining">0</span> TL</div>
      </div>
      <div class="charts">
        <canvas id="chartMonthly" height="140"></canvas>
        <canvas id="chartCategory" height="140"></canvas>
      </div>
    </section>

    <section class="card">
      <h2>Kayıtlar</h2>
      <div class="row wrap">
        <input type="search" id="search" placeholder="Ara (ürün, tür, tarih, kategori)">
        <select id="filterType">
          <option value="hepsi">Hepsi</option>
          <option value="gelir">Gelir</option>
          <option value="gider">Gider</option>
        </select>
        <div class="chipbar">
          <button id="fltAll" class="chip chipOn">Tümü</button>
          <button id="fltYemGider" class="chip">Yem Giderleri</button>
          <button id="fltSutSatis" class="chip">Süt Satışları</button>
          <button id="fltGelir" class="chip">Gelirler</button>
          <button id="fltGider" class="chip">Giderler</button>
          <button id="fltOverdue" class="chip">Vadesi Geçen</button>
        </div>
        <button id="exportCsv" class="secondary">CSV Dışa Aktar</button>
        <button id="exportJson" class="secondary">JSON Dışa Aktar</button>
        <label class="fileLabel">
          JSON İçe Aktar
          <input type="file" id="importJson" accept="application/json" hidden>
        </label>
        <button id="clearAll" class="danger">Tümünü Sil</button>
      </div>

      <div class="tableWrap">
        <table id="recordsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Tür</th>
              <th>Kategori</th>
              <th>Ürün</th>
              <th>Alış Tarihi</th>
              <th>Ödeme</th>
              <th>Birim</th>
              <th>Miktar</th>
              <th>Birim Fiyat</th>
              <th>Toplam</th>
              <th>Ödenen</th>
              <th>Kalan</th>
              <th>İşlem</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- USER MANAGEMENT (Admin only) -->
    <section class="card" id="userMgmt" style="display:none;">
      <h2>Kullanıcı Yönetimi</h2>
      <p class="muted">Yalnızca Yönetici. Kullanıcı ekle/sil, PIN sıfırla.</p>
      <div class="grid">
        <label>Ad / Kullanıcı adı
          <input type="text" id="newUserName" placeholder="örn. Personel 1">
        </label>
        <label>Rol
          <select id="newUserRole">
            <option value="personel">Personel (görüntüleme)</option>
            <option value="admin">Yönetici</option>
          </select>
        </label>
        <label>PIN (4–12 rakam)
          <input type="password" id="newUserPin" pattern="\d{4,12}">
        </label>
      </div>
      <div class="row">
        <button id="addUserBtn">Kullanıcı Ekle</button>
      </div>

      <div class="tableWrap" style="margin-top:12px;">
        <table id="usersTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Ad</th>
              <th>Rol</th>
              <th>İşlem</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <small>Veriler cihazınızda (offline) saklanır. – © Üzülmez Çiftlik</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="app.js"></script>
</body>
</html>
